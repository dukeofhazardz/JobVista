<%- include('header') -%>

<div class>
    <input type="text" id="search-box" placeholder="Enter Keyword..." onkeyup="sendData(this)">
    <section id="searchResults">

    </section>

    <% jobs.forEach((job)=>{ %>
    <div class="jobStyle">
        <h3><%= job.title %></h3>
        <h3><%= job.companyName %></h3>
        <img width="200px" height="200px" src="<%= job.companyLogo %>"
            alt="company logo" />
        <p>

            <%= job.excerpt %>
        </p>
      
        <a href="/jobs/<%= job.title %>">View</a>
    </div>
    <% }) %>
    
     
    <a href="/jobboard?offset=<%= offset %>">More</a>
   
    <div>
    <script>
        function sendData(e) {
            const searchResults = document.getElementById('searchResults');
            let match = e.value.match(/^[a-zA-Z ]*/);
            let match2 = e.value.match(/\s*/);
            if (match2[0] === e.value) {
                searchResults.innerHTML = '';
                return;
            }
            if (match[0] === e.value) {
                fetch('/jobs/search', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({payload: e.value})
                }).then(res => res.json()).then(data => {
                    let payload = data.payload;
                    searchResults.innerHTML = '';
                    if (payload.length < 1) {
                        searchResults.innerHTML = '<p>Sorry, Nothing Found...<p>';
                        return;
                    }
                    payload.forEach((item, index) => {
                        if (index > 0) searchResults.innerHTML += '<hr>';
                        searchResults.innerHTML += `<a href="/jobs/${item.title}">${item.title}</a>`;
                    });
                });
                return;
            }
            searchResults.innerHTML = '';
        }
    </script>

<%- include('footer') -%>